// Generated by CoffeeScript 2.2.0
var currencies, lanes, prices, showBlock, showTx, updatePrices;

currencies = {
  btc: new BTC(),
  eth: new ETH(),
  ltc: new LTC(),
  xrb: new XRB()
};

prices = {};

lanes = {};

// render TX
showTx = function(currency, tx) {
  var fee, price;
  price = tx.amount * prices[currency];
  fee = tx.fee * prices[currency];
  return lanes[currency].addMeteor({
    speed: fee ? 2 + 4 * Math.min(2, Math.log10(1 + fee)) / 2 : 6,
    hue: price ? 220 - 220 * Math.min(6, Math.log10(1 + price)) / 6 : 220,
    thickness: Math.max(5, Math.log10(1 + price) * 10),
    length: Math.min(3, Math.log10(1 + fee)) / 3 * 250,
    link: tx.link
  });
};

// render block
showBlock = function(currency) {
  return lanes[currency].addBlock();
};

// get current price
updatePrices = function(currencies) {
  var currencyAPI;
  currencyAPI = 'https://min-api.cryptocompare.com/data/price?fsym=USD&tsyms=';
  $.get(currencyAPI + currencies.join(',').toUpperCase(), function(data) {
    var currency, price, results;
    if (data) {
      results = [];
      for (currency in data) {
        price = data[currency];
        currency = currency.toLowerCase();
        prices[currency] = Math.round(1 / price * 100) / 100;
        results.push($('.' + currency + ' .price').text(prices[currency]));
      }
      return results;
    }
  });
  return setTimeout(updatePrices.bind(null, currencies), 10 * 1000);
};

// start everything
$(function() {
  updatePrices(Object.keys(currencies));
  return $('.currencies > div').each(function() {
    var canvas, currency;
    currency = $(this).attr('class');
    if (currencies[currency] != null) {
      currencies[currency].start(showTx.bind(null, currency), showBlock.bind(null, currency));
      canvas = $('<canvas></canvas>');
      $('.' + currency).append(canvas);
      return lanes[currency] = new CanvasRenderer(canvas.get(0));
    }
  });
});

//# sourceMappingURL=main.js.map
